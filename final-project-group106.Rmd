---
title: "Data Analysis and Prediction for Life Expectancy"
author: "Group 106: Artsiom Strok, Lin Jiang, Mayank Chhablani"
date: 'July 15, 2019'
output:
  html_document:
    toc: yes
  pdf_document: default
urlcolor: cyan
---

***

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
options(scipen = 1, digits = 4, width = 80)
```

## Introduction


Life expectancy has increased dramatically over the last few centuries. Since 1900 the global average life expectancy has more than doubled and there has been a huge development in health sector in the past 15 years resulting in improvement of human mortality rates especially in the developing nations in comparison to the past 30 years. Therefore, in this project, only data from year 2000-2015 is considered for exploration and analysis. 

This dataset is a compilation of data from the Global Health Observatory (GHO) and United Nations. The GHO data repository is WHO's gateway to health-related statistics which provides access to a variety of indicators on priority health topics including mortality and burden of diseases, environmental health, violence and injuries etc. (http://apps.who.int/gho/data/node.resources). The economic data such as GDP is collected from the National Accounts Main Aggregates Database under United Nations which collects and disseminates economic statistics from countries worldwide (https://unstats.un.org/unsd/snaama/Index). 

This dataset is cleaned by removing some missing values, maily for population, Hepatitis B and GDP from less known countries and shared on Kaggle website (https://www.kaggle.com/kumarajarshi/life-expectancy-who). The final dataset contains 2938 observations with 22 variables which are more critical and representative among all the categories of health-related factors from year 2000 - 2015 for 193 countries.

The description of each variable for this dataset is listed below:

- **Country**: Country
- **Year**: Year
- **Status**: Developed or Developing status
- **Life expectancy**: Life Expectancy in age
- **Adult Mortality**: Adult Mortality Rates of both sexes (probability of dying between 15 and 60 years per 1000 population)
- **infant**: deathsNumber of Infant Deaths per 1000 population
- **Alcohol**: Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)
- **percentage expenditure**: Expenditure on health as a percentage of Gross Domestic Product per capita(%)
- **Hepatitis B**: Hepatitis B (HepB) immunization coverage among 1-year-olds (%)
- **Measles**: Measles - number of reported cases per 1000 population
- **BMI**: Average Body Mass Index of entire population
- **under-five deaths**: Number of under-five deaths per 1000 population
- **Polio**: Polio (Pol3) immunization coverage among 1-year-olds (%)
- **Total expenditure**: General government expenditure on health as a percentage of total government expenditure (%)
- **Diphtheria**: Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-olds (%)
- **HIV/AIDS**: Deaths per 1 000 live births HIV/AIDS (0-4 years)
- **GDP**: Gross Domestic Product per capita (in USD)
- **Population**: Population of the country
- **thinness 1-19 years**: Prevalence of thinness among children and adolescents for Age 10 to 19 (% )
- **thinness 5-9 years**: Prevalence of thinness among children for Age 5 to 9(%)
- **Income composition of resources**: Human Development Index in terms of income composition of resources (index ranging from 0 to 1)
- **Schooling**: Number of years of Schooling(years)

For this project, we would like to:

- identify the major factors that affect the life expectancy
- explore the interactions between the variables such as immunization, moratlity, education, economic factors etc.
- discover the corelation between different factors
- perform residual and outlier diagnostics to exclude some influential points if any
- build a robust multiple linear regression model to predict the life expectancy
- build a classifier to estimate the status of a country (developing or developed)


***

## Methods

```{r, include=FALSE}
#install.packages("DAAG")
#install.packages("corrplot")
#install.packages("ggplot2")
#install.packages("tidyr")
library(DAAG)
library(corrplot)
library(ggplot2)
library(magrittr)
library(knitr)
library(tidyr)
```


### Missing values analysis: 

```{r}
original_data = read.csv("Life Expectancy Data.csv")
kable(t(original_data[sample(nrow(original_data), 5), ]))
kable(colSums(is.na(original_data)), col.names = "Number of missing values")
```


1289 samples have at least one missing value. Alcohol is missing in 194 samples all of them belongs to 2015 year and these countiries definately should have alcohol consuption more than 0. The data was collected in 2015 when data about alcohol consumption simply was not available.

Life expextancy and adult mortality is missing for 10 samples in 2013, all of them belongs to islands.

Hepatitis B is missing in 553 samples. Samples belongs to different countries and years.

```{r}
nrow(original_data)
data = na.omit(original_data)
nrow(original_data) - nrow(data)
```

```{r}
ggplot(gather(data[-c(1, 3)]), aes(value)) + 
    geom_histogram(bins = 10) + 
    facet_wrap(~key, scales = 'free_x')
ggplot(data, aes(x = Status, y = Life.expectancy)) + geom_boxplot()
ggplot(data, aes(x = Adult.Mortality, y = Life.expectancy)) + geom_boxplot()
```




This original dataset contains `Country` variable which we would not use for model building. Therefore, this column is excluded from the following data analysis as well as the records with `NA` in some of the columns mentioned above. This will reduce the size of the original dataset from 2938 to 1649 rows, which captures majority of the information and allows the speed of modeling to be more efficient. 

Below lists the summary and structure of the cleaned dataset.

```{r}
summary(data)
data = na.omit(data)
data = data[-1] #exclude country from dataset
str(data)
```


### Data Visualization

Let's take a look of the dataset using plots of `Life Expectancy` vs `Status` or `Year`. The boxplot indicates that there is significant difference in `Life Expectancy` between the `Developed` and `Developing` countries. As expected, the `Life Expectancy` increases as the `Year` passes by and the Violin plot shows that the data is well distributed across different years. 

```{r}
par(mfrow=c(1,2))
# Histogram of Life Expectancy
hist(data$Life.expectancy,
     xlab = "Life Expectancy",
     main = "Distribution of Life Expectancy",
     col = "dodgerblue",
     breaks = 25)
# Boxplot of Life Expectancy vs Country Status (Developed vs Developing)
plot(data$Status,
     data$Life.expectancy,
     xlab = "Status",
     ylab = "Life Expectancy",
     main = "Life Expectancy vs. Status",
     col = c(2,3))

# Violin plot of Life Expectancy vs. Year
data %>% ggplot() + geom_violin(aes(x=Year, y=Life.expectancy, group=Year, fill=Year)) + labs(title = "Life Expectancy vs. Year")
```


### Exploratory Data Analysis

```{r}
corrplot(cor(data[-c(2)]), method = "circle")
```



```{r}

# train test split 70/30 hold out
train_size = floor(0.7 * nrow(data))
train_idx = sample(nrow(data), train_size)
data.train = data[train_idx, ]
data.test = data[-train_idx, ]


model.additive = lm(Life.expectancy ~ ., data.train)
cv.lm(data.train, model.additive, m = 5, plotit = FALSE)
mean((data.test$Life.expectancy - predict(model.additive, data.test)) ^ 2)

model.selected = step(lm(Life.expectancy ~ ., data.train), trace = FALSE)
cv.lm(data.train, model.selected, m = 5, plotit = FALSE)
mean((data.test$Life.expectancy - predict(model.selected, data.test)) ^ 2)

```


## Results

## Discussion

## Appendix
